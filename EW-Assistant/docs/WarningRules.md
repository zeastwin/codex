# WarningCenter 预警规则

## 数据从哪里来？
- 产能/良率：读取配置路径下的产能 CSV（按小时统计产出和良率。
- 报警：读取配置路径下的报警 CSV，按“报警码+小时”统计次数和停机分钟。
- 时间范围：默认关注“现在往前 12 小时”的数据，用来判断是否要提示。
- 参考值：会向前看 14 天的历史产能，按小时算出一个“参考产能”作为对比。

## 主要规则（默认阈值）
以下阈值可在设置里调整，下面仅列出默认逻辑：
1. **良率太低**  
   - 单小时样本数≥30。良率低于 95% 提示“严重”，低于 97% 提示“警告”。
2. **产量偏低**  
   - 有计划产量或能算出历史参考值（至少 100 条历史样本）。产量低于计划/参考值的 80% 为“严重”，低于 90% 为“警告”。
3. **产能下滑趋势**  
   - 最近 6 小时里，有 4 个及以上小时低于参考值的 90%，提示“警告”。
4. **良率下滑趋势**  
   - 最近 6 小时里，有 4 个及以上小时良率低于 98%，提示“警告”。
5. **良率差并伴随报警**  
   - 当小时既有报警（次数或停机达到报警告警标准），又良率低于 95%。预警等级跟随报警等级。
6. **产量差并伴随报警**  
   - 当小时有报警且产量低于参考值的 80%。预警等级跟随报警等级。
7. **报警高频或停机长**  
   - 同一报警码、同一小时内，次数 ≥5/10 次或停机 ≥10/20 分钟（分别对应警告/严重）会提示。

## 避免重复弹窗
- 同一规则触发后，会在 2 小时内自动抑制重复提醒，并合并同一小时同指标的预警，优先保留更高等级或更严重的描述。

## 预警记录与状态
- 每次触发都会生成一条本地记录（工单），在列表里显示时间段、原因、等级。
- 如果同样问题在 120 分钟内不再出现，会自动标记为“已关闭”；也可以手工标记为已处理或忽略。
